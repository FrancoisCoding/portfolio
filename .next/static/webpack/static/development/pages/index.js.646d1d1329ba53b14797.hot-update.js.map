{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.646d1d1329ba53b14797.hot-update.js","sources":["webpack:///./services/auth0.js"],"sourcesContent":["import auth0 from 'auth0-js';\r\nimport Router from 'next/router';\r\nimport Cookies from 'js-cookie';\r\nimport jwt from 'jsonwebtoken';\r\nimport axios from 'axios';\r\n\r\nclass Auth0 {\r\n    constructor() {\r\n        this.auth0 = new auth0.WebAuth({\r\n            domain: 'dev-muyfhpy4.auth0.com',\r\n            clientID: '1gbOuVc9mDL2rfsmbsDFGOPbWH0eB2oT',\r\n            redirectUri: 'http://localhost:3000/callback',\r\n            responseType: 'token id_token',\r\n            scope: 'openid profile'\r\n        });\r\n\r\n        this.login = this.login.bind(this);\r\n        this.logout = this.logout.bind(this);\r\n        this.handleAuthentication = this.handleAuthentication.bind(this);\r\n    }\r\n\r\n    handleAuthentication() {\r\n        return new Promise((resolve, reject) => {\r\n            this.auth0.parseHash((err, authResult) => {\r\n                if (\r\n                    authResult &&\r\n                    authResult.accessToken &&\r\n                    authResult.idToken\r\n                ) {\r\n                    this.setSession(authResult);\r\n                    resolve();\r\n                } else if (err) {\r\n                    reject(err);\r\n                    console.log(err);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    setSession(authResult) {\r\n        // debugger;\r\n        // Set the time that the Access Token will expire at\r\n        const conversion = authResult.expiresIn * 1000;\r\n        const expiresAt = JSON.stringify(conversion + new Date().getTime());\r\n        Cookies.set('user', authResult.idTokenPayload);\r\n        Cookies.set('jwt', authResult.idToken);\r\n        Cookies.set('expiresAt', expiresAt);\r\n    }\r\n\r\n    logout() {\r\n        // Clear Access Token and ID Token from local storage\r\n        Cookies.remove('user');\r\n        Cookies.remove('jwt');\r\n        Cookies.remove('expiresAt');\r\n        this.auth0.logout({\r\n            returnTo: '',\r\n            clientID: '1gbOuVc9mDL2rfsmbsDFGOPbWH0eB2oT'\r\n        });\r\n    }\r\n\r\n    login() {\r\n        this.auth0.authorize();\r\n    }\r\n\r\n    async getJWKS() {\r\n        const res = await axios.get(\r\n            'https://dev-muyfhpy4.auth0.com/.well-known/jwks.json'\r\n        );\r\n        const jwks = res.data;\r\n        return jwks;\r\n    }\r\n\r\n    async verifyToken(token) {\r\n        if (token) {\r\n            const decodedToken = jwt.decode(token, { complete: true });\r\n            const jwks = await this.getJWKS();\r\n            const jwk = jwks.keys[0];\r\n            // BUILD CERTIFICATE\r\n            let cert = jwk.x5c[0];\r\n            cert = cert.match(/.{1,64}/g).join('\\n');\r\n            cert = `-----BEGIN CERTIFICATE-----\\n${cert}-----END CERTIFICATE-----\\n`;\r\n            //\r\n\r\n            if (jwk.kid === decodedToken.header.kid) {\r\n                try {\r\n                    const verifiedToken = jwt.verify(token, cert);\r\n                    const expiresAt = verifiedToken.exp * 1000;\r\n                    const currentTime = new Date();\r\n                    return verifiedToken && currentTime.getTime() < expiresAt\r\n                        ? decodedToken\r\n                        : undefined;\r\n                } catch (err) {\r\n                    return undefined;\r\n                }\r\n            }\r\n            const expiresAt = decodedToken.exp * 1000;\r\n            const currentTime = new Date();\r\n            return decodedToken && currentTime.getTime() < expiresAt\r\n                ? decodedToken\r\n                : undefined;\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    async clientAuth() {\r\n        const token = Cookies.getJSON('jwt');\r\n        const verifiedToken = this.verifyToken(token);\r\n        return verifiedToken;\r\n    }\r\n\r\n    async serverAuth(req) {\r\n        if (req.headers.cookie) {\r\n            const tokenCookie = req.headers.cookie\r\n                .split(';')\r\n                .find(c => c.trim().startsWith('jwt='));\r\n            if (!tokenCookie) {\r\n                return undefined;\r\n            }\r\n            const token = tokenCookie.split('=')[1];\r\n            const verifiedToken = await this.verifyToken(token);\r\n\r\n            const currentTime = new Date();\r\n            return verifiedToken;\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n\r\nconst auth0Client = new Auth0();\r\n\r\nexport default auth0Client;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAKA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;;;AAEA;AACA;AACA;;;;;;;;;;AAGA;AACA;;AADA;AAGA;AACA;AACA;;;;;;;;;;AAEA;;;;;;;AACA;;;;;AACA;AAAA;AAAA;;AACA;AACA;;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;AAEA;AACA;AACA;AACA;AACA;;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAIA;AACA;;;;;;;;;;;;;;;;AAGA;AACA;AACA;AACA;;;;;;;;;;AAEA;;;;;;AACA;;;;;AACA;AAEA;AAAA;AACA;AAAA;;;;;AACA;AACA;;AACA;;AACA;AACA;;AADA;AAEA;AACA;AACA;;AACA;AACA;;;;;;;;;;;;;AAGA;AAEA;;;;A","sourceRoot":""}